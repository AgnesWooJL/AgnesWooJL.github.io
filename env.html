
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Coffee Environment Page</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://js.arcgis.com/4.32/esri/themes/dark/main.css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://s3.tradingview.com/tv.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css" />
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script src="https://js.arcgis.com/4.32/"></script>
  <!-- Load Calcite components from CDN -->
  <script type="module" src="https://js.arcgis.com/calcite-components/3.0.3/calcite.esm.js"></script>
  <!-- Load Map components from CDN-->
  <script
  type="module"
  src="https://js.arcgis.com/map-components/4.32/arcgis-map-components.esm.js"
  ></script> 
  
  
  
    <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }
    #viewDiv {
      width: 100%;
      height: 100%;
    }
      body {
      font-family: Arial, sans-serif;

    }
    .section-title {
      font-size: 1.5rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
      color: #6f4e37;
    }
    .section-text {
      font-size: 0.95rem;
      line-height: 1.6;
      color: #333;
      margin-bottom: 1.5rem;
    }
      .icon-label {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      font-weight: 500;
    }
    .timeline::before {
      content: "";
      position: absolute;
      left: 16px;
      top: 0;
      bottom: 0;
      width: 2px;
      background-color: #d2b48c;
    }
        #customUI {
            flex: 1;
            padding: 10;
            margin: 0;
            height: 100%;
            width: 100%;
        }
        /* Style for the LayerList widget */
        .esri-layer-list {
        top: 15px;
        left: 15px;   
        }
      


        #terrainAnalysisDiv {
        background-color: var(--calcite-color-background);
        padding: 10px;
        overflow-y: auto;
        }

        #compassRoseDiv {
        display: flex;
        flex-direction: row;
        justify-content: space-evenly;
        }

        #compassRoseSvg {
        width: 130px;
        }

        #compassRoseSvg text {
        fill: var(--calcite-color-text-1);
        font-size: 6px;
        }

        .roseDirection {
        fill: none;
        stroke: var(--calcite-color-border-input);
        stroke-width: 1px;
        pointer-events: all;
        cursor: pointer;
        }

        .roseDirection.active {
        fill: var(--calcite-color-brand);
        }
        .esri


        #infoDiv2 {
            display: flex;
            flex-direction: column;
            padding: 10px;
            width: 500px;
        }

        #cameraControls {
          display: flex;
          flex-direction: row;
          position: absolute;
          top: 10px;
          left: 10px;
          z-index: 10;
          padding: 10px;
          border-radius: 5px;
          background-color: transparent;
          box-shadow: none;
        }

        #cameraControls button {
          display: block;
          margin: 5px 5px;
          padding: 8px 12px;
          background-color: #007ac2;
          color: white;
          border: none;
          border-radius: 3px;
          cursor: pointer;
          box-shadow: #333;
        }

        #cameraControls button:hover {
          background-color: #005f91;
        }
        #colorButton {
        border: 1px solid var(--calcite-color-border-input);
        width: 35px;
        height: 25px;
        background-color: rgb(0, 122, 194);
        cursor: pointer;
        }
  </style>

</head>
  
  
<body class="bg-gray-50 text-gray-800">
 <!-- The global significance of coffee + the global trading chain ‚Üí Background image module -->
  <section class="relative max-w-6xl mx-auto my-12 overflow-hidden rounded-xl shadow-md" data-aos="fade-up">
    
    <!-- background -->
    <div class="absolute inset-0">
      <img src="coffeebg.jpg"  class="w-full h-full object-cover opacity-20" />
      <div class="absolute inset-0 bg-white bg-opacity-60"></div> 
    </div>

    <!-- text -->
    <div class="relative z-10 p-8 space-y-8">
     
      <div>
        <h2 class="section-title">‚òï The environmental conditions to produce coffee</h2>
        <p class="section-text">
          Coffee is produced from a tropical plant called th Coffea plant. The coffee bean is the seed of the Coffea plant, and it is the main ingredient in coffee. Most Coffee beans are from two varieties of the Coffea that is the Arabica and the Robusta.
          The different variation requires specific environmental conditions to thrive, including:
          <ul class="list-disc ml-6">
            <li>‚òï Robusta: Grows well at lower altitudes with higher temperatures</li>
            <ul class="list-disc ml-6">
              <li>üå°Ô∏è Temperature: 22-30¬∞C (59-75¬∞F) Source: (Kath et el., 2020) </li>
              <li>üå± Altitude: 200-800m (2000-6500ft) above sea level Source: (FHA, 2024)</li>
              <li>üíß Rainfall: 1250-2500mm (39-79 inches) annually Source:(Noraini et el., 2024) </li>

            </ul>
            <br>

            <li>‚òï Arabica: Grows best at higher altitudes with cooler temperatures</li>
            <ul class="list-disc ml-6">
            <li>üå°Ô∏è Temperature: 18-21¬∞C (59-75¬∞F) Source: (Scott, 2015)</li>
            <li>üå± Altitude: 1000-2000m (2000-6500ft) above sea level (Noraini et el., 2024)</li>
            <li>üíß Rainfall: 1250-2500mm (39-79 inches) annually Source: (Noraini et el., 2024)</li>

            </ul>
          </ul>
        </p>
      </div>

     
      <div>
        <h2 class="section-title">üåç Main Producers of Coffee</h2>
        <p class="section-text">
        Generally consistent with most literature, the main producers of coffee is found in the tropic regions also known as <em>The Coffee Belt</em> due to the availability of suitable growing conditions in Alititude, Temperature, and Rainfall. The top producer countries being Brazil, Colombia, Vietnam, and Indonesia. However, with climate change, temperatures are generally rising across all regions (Lindsey & Dahlman,2024). The environmental changes could possible cause a shift in the dominance of the current top producers.</p>

        <p class="section-text">
          The below map is a visual aid map to inspect the different environmental conditions suitable to plant the different varieties of Coffee.</p>
      </div>
    </div>

  </section>
  
  
  
<!-- map and the graph -->
<div class="h-[800px] flex">
  <!-- left-selection -->
  


  <div class="flex-1 bg-gray-200 relative">
  

    <div id="viewDiv" class="w-full h-full"></div>
      <div id="cameraControls" class="esri-widget" style="position: relative; top: 10px; left: 10px; z-index: 10;">
        <button id="brazil">Brazil</button>
        <button id="colombia">Colombia</button>
        <button id="vietnam">Vietnam</button>
        <button id="indonesia">Indonesia</button>
      </div>


    <div id ="infoDiv2" class="esri-widget" style="flex-direction: column;">
      <h4 class="esri-editor__title esri-heading" style="padding: 10px">Annual Rainfall (mm)</h4>
      <div id="pixelVal" style="padding: 10px 10px 10px 10px"></div>
      <br>
      <div id="pixelSlider" class="slider"></div>

  </div>
  </div>

</div>
  
   <section class="bg-white shadow-md rounded-xl p-6 max-w-6xl mx-auto mt-10" data-aos="fade-up">
  <h2 class="text-2xl font-bold text-gray-800 mb-4">Evaluation of environmental conditions</h2>
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    
    <!-- Point 1 -->
    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-lg shadow-sm">
      <h3 class="font-semibold text-lg mb-1">Temperature</h3>
      <p class="text-gray-700 text-sm">
        Overall, temperature is not a key factor for growing Robusta coffee, but it is crucial for Arabica coffee. The tropics by nature is generally warm. However, with temperature is rising due to climate change, growing Arabica coffee is becoming more difficult. 
      </p>
    </div>

    <!-- Point 2 -->
    <div class="bg-pink-50 border-l-4 border-pink-400 p-4 rounded-lg shadow-sm">
      <h3 class="font-semibold text-lg mb-1">Alititude</h3>
      <p class="text-gray-700 text-sm">
        As Alititude is a key factor in determining the ability for a country to grow both varieties of coffee. It is a limiting factor for a number of lowland tropic countries though temperature and rainfall level are suitable.
      </p>
    </div>

    <!-- Point 3 -->
    <div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded-lg shadow-sm">
      <h3 class="font-semibold text-lg mb-1">Rainfall</h3>
      <p class="text-gray-700 text-sm">
        Rainfall surprisingly is a limiting factor due to a lower amount of rainfall in areas where the temperature and alititude are suitable. This particularly so for more inland countries such as Ethiopia, and Laos.
      </p>
    </div>

    <!-- Point 4 -->
    <div class="bg-green-50 border-l-4 border-green-400 p-4 rounded-lg shadow-sm">
      <h3 class="font-semibold text-lg mb-1">Overall Evaluation</h3>
      <p class="text-gray-700 text-sm">
        Overall, the environmental conditions are a limiting factor in a country's ability to grow coffee. The most limiting factor is the alititude of the country, followed by rainfall and temperature. These three factors are interrelated, with altitude affecting temperature and rainfall patterns.
      </p>
    </div>
  </div>
</section>



  <section class="max-w-6xl mx-auto mt-10 grid grid-cols-1 md:grid-cols-2 gap-8">
  
  <!-- lefe-coffeetravel-video -->
  <div class="bg-white shadow-lg p-6 rounded-xl" data-aos="fade-up">
    <h2 class="text-xl font-bold mb-2">‚òï Other environmental considerations</h2>
    <p class="text-gray-700 mb-4">
      Additional environmental considerations may influence coffee production; however, they are not reflected in the above evaluation due to their finer spatial resolution. These include: 
      <ul class="list-disc ml-6">  
        <li>‚òï <b>Soil Quality:</b> The coffee plants require a acidic soil at around 4.9 to 5.2pH which can be changed with argochemicals. (Manson et el., 2022)</li>
        <li>‚òï <b>Shade:</b> Coffee plants thrive in shaded areas, which can be influenced by the slope aspect.</li>
        <li>‚òï <b>Pests and Diseases:</b> Coffee plants are susceptible to various pests and diseases, which can affect yield and quality.</li>
      </ul>
      <br>
      At the global scale, these factors are not as significant as the three main factors mentioned above. However, they can still have a significant impact on coffee production at the local level. For example, in some regions, soil quality may be a limiting factor for coffee production, while in others, pests and diseases may be more important especially in the tropic regions.
    </p>

  </div>

  <!-- right-trade view -->
  <div class="bg-white shadow-lg p-6 rounded-xl" data-aos="fade-up">
    <h2 class="text-xl font-bold mb-2">‚òï Techtonic areas as potential guide</h2>
    <p class="text-gray-700 mb-4"> The tectonic plate map is a useful tool for evaluating the environmental conditions suitable for growing coffee. An observation of the map shows that most of the coffee-producing countries and their suitable areas are located along the edges of tectonic plates. The mountaion ranges formed by the tectonic plates create the highland areas that are suitable for growing coffee. The tectonic plate map can be used to identify potential new coffee-producing regions by looking for areas with similar environmental conditions to those found in existing coffee-producing countries especially with considerations of the overall increasing global temperature. Areas outside the tropic regions may be suitable for growing coffee in the future as the climate changes. </p>
    <img src="plate_tectonics.png" alt="Techteonic plate picture">
      
  </div>

</section>


<!-- data source -->
<section class="max-w-6xl mx-auto bg-white mt-12 p-6 rounded-xl shadow-md" data-aos="fade-up">
  <h2 class="section-title">üìä Data Sources & References</h2>
  <b>Data Sources:</b>
  <ul class="list-disc ml-6 text-sm text-gray-700 space-y-1">
    <li><b>Annual Rainfall:</b> Imagery Layer from <a href="https://geo.fas.usda.gov/arcgis2/rest/services/G_Climatology/Annual_Rainfall/ImageServer" style="color: #007ac2;">REST API SERVER</a></li>

    <li><b>Temperature:</b> Feature Layer from <a href = "https://services.arcgis.com/jIL9msH9OI208GCb/arcgis/rest/services/Average_Annual_Temperature/FeatureServer" style="color: #007ac2;">REST API SERVER</a></li>
    <li><b>Altitude:</b> Imagery Tile Layer from <a href = "https://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer" style="color: #007ac2;">REST API SERVER</a></li>
    <li><b>Countries Boundaries</b> Feature Layer from <a href = "https://services.arcgis.com/P3ePLMYs2RVChkJx/arcgis/rest/services/World_Countries/FeatureServer" style="color: #007ac2;">REST API SERVER</a></li>
  </ul>
  <br>
  <b>References:</b>
  <ul class="list-disc ml-6 text-sm text-gray-700 space-y-1 mt-4">
    <li>EarthHow. (2025). plate_tectonics_labels-850x502. 7 Major Tectonic Plates: The World‚Äôs Largest Plate Tectonics. Retrieved 2025, from https://earthhow.com/wp-content/uploads/2019/01/plate_tectonics_labels-850x502.png</li>
    <li>FHA. (2024, February 29). Robusta coffee: Origins, benefits, and how to brew. Food & Hospitality Asia. https://foodnhotelasia.com/glossary/horeca/robusta-coffee/ </li>
    <li>Kath, J., Byrareddy, V. M., Craparo, A., Nguyen‚ÄêHuy, T., Mushtaq, S., Cao, L., & Bossolasco, L. (2020). Not so robust: Robusta coffee production is highly sensitive to temperature. Global Change Biology, 26(6), 3677‚Äì3688. https://doi.org/10.1111/gcb.15097 </li>
    <li>Lindsey , R., & Dahlman, L. (2024, January 18). Climate change: Global temperature. NOAA Climate.gov. https://www.climate.gov/news-features/understanding-climate/climate-change-global-temperature </li>
    <li>Manson, S., Nekaris, K. A., Rendell, A., Budiadi, B., Imron, M. A., & Campera, M. (2022). Agrochemicals and shade complexity affect soil quality in Coffee Home Gardens. Earth, 3(3), 853‚Äì865. https://doi.org/10.3390/earth3030049 </li>
    <li>Noraini, A., Tjahjadi, M. E., & Jasmani, J. (2024). Classification of slope for coffee plantation in Ngajum District, Indonesia. Buletin Poltanesa, 25(1), 110‚Äì115. https://doi.org/10.51967/tanesa.v25i1.2227 </li>
    <li>Scott, M. (2015, June 19). Climate & Coffee. NOAA Climate.gov. https://www.climate.gov/news-features/climate-and/climate-coffee</li>
  </ul>
  <br>
  <b>Additional Resources:</b>
  <ul class="list-disc ml-6 text-sm text-gray-700 space-y-1">
    <li>https://developers.arcgis.com/javascript/latest/sample-code/layers-imagery-pixelvalues/</li>
    <li>https://developers.arcgis.com/javascript/latest/sample-code/elevation-analysis/</li>
  </section>
  <a href="homepage.html"
   class="fixed top-4 right-4 z-50 px-4 py-2 bg-white border border-gray-300 shadow rounded-full text-sm text-gray-800 hover:bg-amber-100 transition">
  üè† Homepage
</a>

  
  <footer class="bg-gray-100 mt-16 py-8 text-sm text-gray-600 border-t">
  <div class="max-w-6xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
    
    <!-- copyright -->
    <div>
      ¬© 2025 Coffee Trade Insights. All rights reserved.
    </div>

    <!-- social media -->
    <div class="flex space-x-4">
      <a href="#" class="hover:underline">About</a>
      <a href="#" class="hover:underline">GitHub</a>
      <a href="#" class="hover:underline">Privacy Policy</a>
    </div>

    <!-- author -->
    <div>
      Created by <a href="#" class="text-amber-600 font-medium hover:underline">Group 6</a>
    </div>
    
  </div>
</footer>

<script>
  
  AOS.init();
  require([
      "esri/WebScene",
      "esri/views/SceneView",
      "esri/layers/FeatureLayer",
      "esri/widgets/Legend",
      "esri/widgets/LayerList",
      "esri/widgets/Compass",
      "esri/widgets/Zoom",
      "esri/widgets/Home",
      "esri/core/reactiveUtils",
      "esri/layers/support/RasterFunction",
      "esri/layers/support/rasterFunctionUtils",
      "esri/layers/ImageryTileLayer",
      "esri/layers/WMSLayer",
      "esri/layers/GraphicsLayer",
      "esri/Graphic",
      "esri/geometry/Polygon",
      "esri/layers/ImageryLayer",
      "esri/widgets/Expand",
      "esri/renderers/ClassBreaksRenderer",
      "esri/widgets/Slider",
      "esri/Camera"
    
  ], 
  function(
      Map,
      SceneView,
      FeatureLayer,
      Legend,
      LayerList,
      Compass,
      Zoom,
      Home,
      reactiveUtils,
      RasterFunction,
      rasterFunctionUtils,
      ImageryTileLayer,
      WMSLayer,
      GraphicsLayer, 
      Graphic, 
      Polygon,
      ImageryLayer,
      Expand,
      ClassBreaksRenderer,
      Slider,
      Camera
  ){
      
      // Renderer
      const renderer = {
          type: "unique-value", // autocasts as new UniqueValueRenderer()
          field: "TminC",
          defaultSymbol: {
              type: "simple-fill",
              color: [130, 130, 130, 0.5], // Default gray color
              outline: {
              type: "simple-line",
              color: [110, 110, 110, 0.5],
              width: 0.7
              }
          },
          defaultLabel: "",
          uniqueValueInfos: [
              {
              symbol: {
                  type: "simple-fill",
                  color: [18, 44, 96, 0.5], // Dark blue
                  outline: {
                  type: "simple-line",
                  color: [18, 44, 96, 0.5],
                  width: 0.7
                  }
              },
              value: "-50",
              label: "-50"
              },
              {
              symbol: {
                  type: "simple-fill",
                  color: [24, 54, 103, 0.5], // Slightly lighter blue
                  outline: {
                  type: "simple-line",
                  color: [24, 54, 103, 0.5],
                  width: 0.7
                  }
              },
              value: "-45",
              label: "-45"
              },
              {
              symbol: {
                  type: "simple-fill",
                  color: [31, 65, 110, 0.5], // Lighter blue
                  outline: {
                  type: "simple-line",
                  color: [31, 65, 110, 0.5],
                  width: 0.7
                  }
              },
              value: "-40",
              label: "-40"
              },
              {
              symbol: {
                  type: "simple-fill",
                  color: [39, 77, 117, 0.5], // Even lighter blue
                  outline: {
                  type: "simple-line",
                  color: [39, 77, 117, 0.5],
                  width: 0.7
                  }
              },
              value: "-35",
              label: "-35"
              },
              {
              symbol: {
                  type: "simple-fill",
                  color: [48, 88, 124, 0.5], // Transition to gray-blue
                  outline: {
                  type: "simple-line",
                  color: [48, 88, 124, 0.5],
                  width: 0.7
                  }
              },
              value: "-30",
              label: "-30"
              },
              {
              symbol: {
                  type: "simple-fill",
                  color: [57, 100, 131, 0.5], // Gray-blue
                  outline: {
                  type: "simple-line",
                  color: [57, 100, 131, 0.5],
                  width: 0.7
                  }
              },
              value: "-25",
              label: "-25"
              },
              {
              symbol: {
                  type: "simple-fill",
                  color: [67, 112, 138, 0.5], // Light gray-blue
                  outline: {
                  type: "simple-line",
                  color: [67, 112, 138, 0.5],
                  width: 0.7
                  }
              },
              value: "-20",
              label: "-20"
              },
              {
              symbol: {
                  type: "simple-fill",
                  color: [91, 131, 152, 0.5], // Light gray
                  outline: {
                  type: "simple-line",
                  color: [91, 131, 152, 0.5],
                  width: 0.7
                  }
              },
              value: "-15",
              label: "-15"
              },
              {
              symbol: {
                  type: "simple-fill",
                  color: [132, 159, 173, 0.5], // Lighter gray
                  outline: {
                  type: "simple-line",
                  color: [132, 159, 173, 0.5],
                  width: 0.7
                  }
              },
              value: "-10",
              label: "-10"
              },
              {
              symbol: {
                  type: "simple-fill",
                  color: [179, 189, 194, 0.5], // Very light gray
                  outline: {
                  type: "simple-line",
                  color: [179, 189, 194, 0.5],
                  width: 0.7
                  }
              },
              value: "-5",
              label: "-5"
              },
              {
              symbol: {
                  type: "simple-fill",
                  color: [208, 202, 192, 0.5], // Off-white
                  outline: {
                  type: "simple-line",
                  color: [208, 202, 192, 0.5],
                  width: 0.7
                  }
              },
              value: "0",
              label: "0"
              },
              {
              symbol: {
                  type: "simple-fill",
                  color: [216, 200, 169, 0.5], // Light beige
                  outline: {
                  type: "simple-line",
                  color: [216, 200, 169, 0.5],
                  width: 0.7
                  }
              },
              value: "5",
              label: "5"
              },
              {
              symbol: {
                  type: "simple-fill",
                  color: [224, 196, 143, 0.5], // Beige-orange
                  outline: {
                  type: "simple-line",
                  color: [224, 196, 143, 0.5],
                  width: 0.7
                  }
              },
              value: "10",
              label: "10"
              },
              {
              symbol: {
                  type: "simple-fill",
                  color: [228, 185, 115, 0.5], // Light orange
                  outline: {
                  type: "simple-line",
                  color: [228, 185, 115, 0.5],
                  width: 0.7
                  }
              },
              value: "15",
              label: "15"
              },
              {
              symbol: {
                  type: "simple-fill",
                  color: [229, 164, 86, 0.5], // Bright orange
                  outline: {
                  type: "simple-line",
                  color: [229, 164, 86, 0.5],
                  width: 0.7
                  }
              },
              value: "20",
              label: "20"
              },
              {
              symbol: {
                  type: "simple-fill",
                  color: [229, 139, 57, 0.5], // Dark orange
                  outline: {
                  type: "simple-line",
                  color: [229, 139, 57, 0.5],
                  width: 0.7
                  }
              },
              value: "25",
              label: "25"
              },
              {
              symbol: {
                  type: "simple-fill",
                  color: [229, 109, 29, 0.5], // Deep orange
                  outline: {
                  type: "simple-line",
                  color: [229, 109, 29, 0.5],
                  width: 0.7
                  }
              },
              value: "30",
              label: "30"
              },
              {
              symbol: {
                  type: "simple-fill",
                  color: [230, 76, 0, 0.5], // Red-orange
                  outline: {
                  type: "simple-line",
                  color: [230, 76, 0, 0.5],
                  width: 0.7
                  }
              },
              value: "34",
              label: "34"
              }
          ]
      };
      
      const classbreak_renderer = {
          type: "class-breaks", // Use ClassBreaksRenderer
          field: "TmaxC", // Field used for classification
          defaultSymbol: {
              type: "simple-fill",
              color: [130, 130, 130, 0], // Default gray color
              outline: {
              type: "simple-line",
              color: [110, 110, 110, 0.5],
              width: 0.7
              }
          },
          defaultLabel: "Other",
          classBreakInfos: [
              {
              minValue: 18, // Values above 26
              maxValue: 22,
              symbol: {
                  type: "simple-fill",
                  color: [170, 80, 0, 0.5], // Light gray
                  outline: {
                  type: "simple-line",
                  color: [180, 180, 180, 0.5],
                  width: 0.7
                  }
              },
              label: "Arabica 18 to 22¬∞C"
              },
              {
              minValue: 22, // Values between 14 and 26
              maxValue: 30,
              symbol: {
                  type: "simple-fill",
                  color: [0, 255, 0, 0.5], // Light green
                  outline: {
                  type: "simple-line",
                  color: [120, 200, 120, 0.5],
                  width: 0.7
                  }
              },
              label: "Robusta 22 to 30¬∞C"
              },
          ]
          };

         
      const customAnalysisParams = {
          elevation: { min: 2000, max: 9000 },
          slope: { min: 10, max: 90 },
          aspects: { N: false, NE: false, E: false, SE: true, S: true, SW: true, W: false, NW: false }
      };

      let activeAnalysisMode = "Custom"; // Can be "Custom", "Elevation", or "Slope"
      
      // Slope Raster Function
      const slope = rasterFunctionUtils.slope({
          slopeType: "degree",
          zFactor: 1
      });

      // Remap slope values to categorical ranges
      const remapSlope = rasterFunctionUtils.remap({
      rangeMaps: [
          { range: [30, 35], output: 30 },
          { range: [35, 40], output: 35 },
          { range: [40, 45], output: 40 },
          { range: [45, 90], output: 45 }
      ],
      outputPixelType: "u8",
      raster: slope
      });

      // Map categorical ranges to RGB colors
      const colorMapSlope = rasterFunctionUtils.colormap({
      colormap: [
          [30, 255, 255, 0],
          [35, 255, 165, 0],
          [40, 255, 0, 0],
          [45, 128, 0, 128]
      ],
      raster: remapSlope
      });

      // Elevation Raster Function
      const colorMapElevation = rasterFunctionUtils.colormap({
      colorRampName: "elevation1"
      });

      // Custom Analysis Raster Function
      let customColor = [0, 122, 194];
      function createCustomAnalysis(color = customColor) {
      const elevationMask = rasterFunctionUtils.mask({
          includedRanges: [[customAnalysisParams.elevation.min, customAnalysisParams.elevation.max]],
          noDataValues: [[-9999]],
          noDataInterpretation: "match-any"
      });

      const slopeFunction = rasterFunctionUtils.slope({
          slopeType: "degree",
          zFactor: 1,
          raster: elevationMask
      });

      const slopeMask = rasterFunctionUtils.mask({
          includedRanges: [[customAnalysisParams.slope.min, customAnalysisParams.slope.max]],
          noDataValues: [[-9999]],
          noDataInterpretation: "match-any",
          raster: slopeFunction
      });

      const greaterThanSlope0 = rasterFunctionUtils.greaterThanEqual({
          raster: slopeMask,
          raster2: 0
      });

      const aspectFunction = rasterFunctionUtils.aspect({
          raster: elevationMask
      });

      const remapAspectFunction = rasterFunctionUtils.remap({
          rangeMaps: [
          { range: [-Infinity, 0], output: 1 },
          { range: [360, Infinity], output: 1 },
          { range: [337.5, 360], output: +customAnalysisParams.aspects.N },
          { range: [0, 22.5], output: +customAnalysisParams.aspects.N },
          { range: [22.5, 67.5], output: +customAnalysisParams.aspects.NE },
          { range: [67.5, 112.5], output: +customAnalysisParams.aspects.E },
          { range: [112.5, 157.5], output: +customAnalysisParams.aspects.SE },
          { range: [157.5, 202.5], output: +customAnalysisParams.aspects.S },
          { range: [202.5, 247.5], output: +customAnalysisParams.aspects.SW },
          { range: [247.5, 292.5], output: +customAnalysisParams.aspects.W },
          { range: [292.5, 337.5], output: +customAnalysisParams.aspects.NW }
          ],
          raster: aspectFunction
      });

      const combineAspectSlope = rasterFunctionUtils.booleanAnd({
          raster: greaterThanSlope0,
          raster2: remapAspectFunction
      });

      const colorMapFinal = rasterFunctionUtils.colormap({
          colormap: [[1, ...color]],
          raster: combineAspectSlope
      });

      return colorMapFinal;
      }


      //////////////////////////////
      ////////// Layers ////////////
      //////////////////////////////


      // Typical usage
      //const wmsLayer = new WMSLayer({
      //    url: "https://maps.isric.org/mapserv?map=/map/phh2o.map",
      //    //sublayers: [{
      //    //name: "phh2o_0-5cm_mean" // Specify the layer name
      //    //}],
      //    title: "Soil"
      //});
      //wmsLayer.load().then(() => {
      //const names = wmsLayer.allSublayers
      //                    .filter((sublayer) => !sublayer.sublayers) // Non-grouping layers will not have any "sublayers".
      //                    .map((sublayer) => sublayer.name);
      //console.log("Names of all child sublayers", names.join());
      //
      //});

      const Precip_layer = new ImageryLayer({
          url: "https://geo.fas.usda.gov/arcgis2/rest/services/G_Climatology/Annual_Rainfall/ImageServer",
          pixelFilter: maskPixels,
          title: "Annual Rainfall",
          opacity: 0.5,
      });


    

      const analysisLayer = new ImageryTileLayer({
          url: "https://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",
          title: "Alititude and Slope",
          rasterFunction: createCustomAnalysis(customColor),
          opacity: 0.8
          });
          //map.add(analysisLayer);

      const districtBoundaryLayer = new FeatureLayer({
          url: "https://services.arcgis.com/P3ePLMYs2RVChkJx/arcgis/rest/services/World_Countries/FeatureServer",
          renderer: {
              type: "simple",
              symbol: {
              type: "simple-line",
              color: [0, 0, 0, 1],
              width: 1
              }
          },
          title: "Country Boundaries",
          opacity: 0.8
      });// Terrain analysis parameter
      
      const TempLayer = new FeatureLayer({
          url: "https://services.arcgis.com/jIL9msH9OI208GCb/arcgis/rest/services/Average_Annual_Temperature/FeatureServer",
          renderer: classbreak_renderer,
          title: "Average Annual Temperature",
          outFields: ["*"],
          popupTemplate: {
              title: "Temperature Information",
              content: "Min Temperature: {TminC}‚ÑÉ, Max Temperature: {TmaxC}‚ÑÉ",
              fieldInfos: [
              { fieldName: "TminC", format: { digitSeparator: true, places: 0 } },
              { fieldName: "TmaxC", format: { digitSeparator: true, places: 0 } }
              ]
          }
      });

        // Define the Coffee Belt polygon
      const coffeeBeltPolygon = new Polygon({
          rings: [
          [[-180, 90],   // Top-left corner (North Pole, 180¬∞W)
          [180, 90],    // Top-right corner (North Pole, 180¬∞E)
          [180, 25],    // Bottom-right corner (25¬∞N, 180¬∞E)
          [-180, 25],   // Bottom-left corner (25¬∞N, 180¬∞W)
          [-180, 90]],  // Close the polygon

          // Second polygon: Area below the coffee belt (south of 30¬∞S)
          [[-180, -30],  // Top-left corner (30¬∞S, 180¬∞W)
          [180, -30],   // Top-right corner (30¬∞S, 180¬∞E)
          [180, -90],   // Bottom-right corner (South Pole, 180¬∞E)
          [-180, -90],  // Bottom-left corner (South Pole, 180¬∞W)
          [-180, -30]]  // Close the polygon
          ],
          spatialReference: { wkid: 4326 } // WGS84 coordinate system
      });

      // Create a graphic for the Coffee Belt
      const coffeeBeltGraphic = new Graphic({
          geometry: coffeeBeltPolygon,
          symbol: {
          type: "simple-fill", // Simple fill symbol
          color: [0,0, 0, 0.5], // Orange color with transparency
          outline: {
              color: [255, 0, 0, 0.8], // Solid orange outline
              width: 2
          }
          },
          title: "The Coffee Belt",
          popupTemplate: {
          title: "Outside the Coffee Belt",
          content: "This is the region outside of the 25¬∞N and 30¬∞S latitude where most coffee is grown."
          }
      });

      // Add the graphic to a GraphicsLayer
      const coffeebeltLayer = new GraphicsLayer(
          {
              title:"The Coffee Belt"
          }
      );
      coffeebeltLayer.add(coffeeBeltGraphic);


      const map = new Map({
          portalItem: { // autocasts as new PortalItem()
              id: "dac0b9b188e146baa504c9cfb6eb8d00"  // ID of the WebScene on the on-premise portal
          },
          layers: [ analysisLayer, Precip_layer,TempLayer, coffeebeltLayer, districtBoundaryLayer, ]
      });
      // Move the analysis layer to the top
      map.reorder(districtBoundaryLayer, 0); // Place featureLayer at the bottom
      map.reorder(analysisLayer, 1);

      const view = new SceneView({

          container: "viewDiv",
          map: map,
          camera: {
              position: {
              latitude: 0,
              longitude: 0,
              z: 25000000
              },
              tilt: 0,
              heading: 0
          }
      });

       // Slider to mask imagery layer based on its pixel values
       const pixelSlider = new Slider({
              container: "pixelSlider",
              min: 0.1,
              max: 5000,
              steps: 1,
              values: [1250, 2500],
              visibleElements: {
                  labels: true,
                  rangeLabels: true
              }
              });
              pixelSlider.on(["thumb-drag", "thumb-change", "segment-drag"], updatePixelFilter);


              view.ui.add("infoDiv2", "bottom-left");
              view.ui.add("cameraControls", "top-right");
              let currentMin, currentMax;

              // This function is called when user is moves the slider thumb to
              // the pixel values of imagery layer based on temperature
              // if pixel value lies between slider min and max
              function updatePixelFilter() {
              distance = pixelSlider.values[0];
              currentMin = Math.floor(pixelSlider.values[0]);
              currentMax = Math.floor(pixelSlider.values[1]);
              document.getElementById(
                  "pixelVal"
              ).innerHTML = `Currently displaying locations with sea temperatures from ${currentMin}(mm) to ${currentMax}(mm)`;
              Precip_layer.redraw();
              }

              // /**********************************************************
              // * The PixelFilter function. This function is used to color the
              // * pixels. By default, each pixel has one band containing
              // * a temperature value. We will replace the single band with
              // * three bands - red, green, and blue to give color to the layer.
              // *********************************************************/

              function maskPixels(pixelData) {
              if (!pixelData || !pixelData.pixelBlock) {
                  console.error("Invalid pixel data or pixel block.");
                  return;
              }

              const pixelBlock = pixelData.pixelBlock;
              const pixels = pixelBlock.pixels;

              // Debug: Log pixel block structure

              // Ensure the pixel block has 3 bands (R, G, B)
              if (!pixels || pixels.length !== 3) {
                  console.error("Pixel block does not contain 3 bands (R, G, B).");
                  return;
              }

              const rBand = pixels[0]; // Red band
              const gBand = pixels[1]; // Green band
              const bBand = pixels[2]; // Blue band

              const numPixels = pixelBlock.width * pixelBlock.height;
              const mask = new Uint8Array(numPixels); // Create a mask array

              // Initialize slider range if not set
              if (currentMin == null || currentMax == null) {
                  updatePixelFilter();
              }

              // Loop through all pixels and calculate intensity
              for (let i = 0; i < numPixels; i++) {
                  // Calculate intensity using weighted RGB formula
                  const intensity = 0.299 * rBand[i] + 0.587 * gBand[i] + 0.114 * bBand[i];

                  // Scale intensity to the range of 0‚Äì5000
                  const scaledIntensity = (intensity / 255) * 5000;

                  // Debug: Log scaled intensity values

                  // Check if the scaled intensity falls within the slider range
                  if (scaledIntensity >= currentMin && scaledIntensity <= currentMax) {
                  mask[i] = 1; // Keep the pixel
                  } else {
                  mask[i] = 0; // Mask out the pixel
                  }
              }

              // Apply the mask to the pixel block
              pixelBlock.mask = mask;

              // Update the pixel block with the filtered RGB values
              pixelData.pixelBlock.pixels = [rBand, gBand, bBand];
              pixelData.pixelBlock.statistics = null;
              pixelData.pixelBlock.pixelType = "u8";
              
              }




      //const legend = new Legend({ view });
      const layerList = new LayerList({
          view,
          listItemCreatedFunction: (event) => {
              const item = event.item;
              if (item.layer.type !== "group") {
              item.panel = { content: "legend", open: false };
              }
          }
          });

      view.ui.add(layerList, "top-left");
      //view.ui.add(legend, "bottom-left");
      

      const infoDiv = document.createElement("div");
      infoDiv.style.position = "relative";
      infoDiv.style.bottom = "10px";
      infoDiv.style.left = "0px"; // Align to the left edge
      //infoDiv.style.transform = "translateX(10px)"; // Offset inward by 10px
      infoDiv.style.background = "rgba(0, 0, 0, 0.8)";
      infoDiv.style.padding = "10px";
      infoDiv.style.fontSize = "14px";
      infoDiv.style.color = "rgba(255,255, 255, 1)";

      function updateCameraInfo() {
      const cam = view.camera;
      infoDiv.innerHTML = `
          <b>Scale:</b> 1:${Math.round(view.scale)} <br>
          <b>Lat:</b> ${cam.position.latitude.toFixed(6)}¬∞, 
          <b>Lon:</b> ${cam.position.longitude.toFixed(6)}¬∞ <br>
          <b>Alt:</b> ${cam.position.z.toFixed(2)} m <br>
          <b>Heading:</b> ${cam.heading.toFixed(2)}¬∞ <br>
          <b>Tilt:</b> ${cam.tilt.toFixed(2)}¬∞`;

          
      }

      reactiveUtils.watch(
      () => [view.scale, view.camera],
      updateCameraInfo
      );

      document.body.appendChild(infoDiv);

      view.ui.add(infoDiv, "bottom-right");
          const countries = {
      brazil: {
        latitude:- 26.446994,
        longitude: -45.820850,
        elevation: 261925.16, // Elevation in meters (zoomed out for large countries)
        tilt:  54.89,
        heading: 1.58
      },
      colombia: {
        latitude: -4.943921,
        longitude: -77.648538,
        elevation: 399447.91,
        tilt: 65.45,
        heading: 9.21
      },
      vietnam: {
        latitude: 6.288890,
        longitude: 110.913559,
        elevation: 708151.24,
        tilt: 49.36,
        heading: 334.21
      },
      indonesia: {
        latitude: -10.143932,
        longitude: 101.732483,
        elevation: 544393.77,
        tilt: 57.45,
        heading: 358.34
      }
    };
        // Add event listeners to buttons
      document.getElementById("brazil").addEventListener("click", () => goToCountry(countries.brazil));
      document.getElementById("colombia").addEventListener("click", () => goToCountry(countries.colombia));
      document.getElementById("vietnam").addEventListener("click", () => goToCountry(countries.vietnam));
      document.getElementById("indonesia").addEventListener("click", () => goToCountry(countries.indonesia));

      // Function to move the camera to a specific country
      function goToCountry(target) {
        const { latitude, longitude, elevation, tilt, heading } = target;

        // Create a camera position
        const camera = new Camera({
          position: {
            latitude,
            longitude,
            z: elevation || 1000000 // Default elevation if not provided
          },
          tilt: tilt || 0, // Default tilt if not provided
          heading: heading || 0 // Default heading if not provided
        });

        // Animate the camera to the target location
        view.goTo(camera, {
          duration: 2000, // Animation duration in milliseconds
          easing: "ease-in-out" // Easing function for smooth transitions
        }).catch((error) => {
          console.error("Error moving camera:", error);
        });
      }


      const customUI = document.createElement("div");
      customUI.style.position = "absolute";
      customUI.style.top = "10px";
      customUI.style.right = "10px";
      customUI.style.padding = "10px";
      customUI.style.fontSize = "14px";
      customUI.style.width = "320px";      
      customUI.style.background = "rgba(0, 0, 0, 0.8)";
      customUI.innerHTML = `
      <!-- Segmented Control for Analysis Modes -->
      <calcite-segmented-control id="analysisModeSegmentedControl">
          <calcite-segmented-control-item icon-start="surface" value="Custom" checked>Custom</calcite-segmented-control-item>
          <calcite-segmented-control-item icon-start="altitude" value="Elevation">Elevation</calcite-segmented-control-item>
          <calcite-segmented-control-item icon-start="take-pedestrian-ramp" value="Slope">Slope</calcite-segmented-control-item>
      </calcite-segmented-control>
          <br>
          <calcite-label scale="s">
            Transparency | %
            <calcite-slider id="opacitySlider" value="0" label-handles max-label="100" min-label="0"
              ticks="10"></calcite-slider>
          </calcite-label>
  
          <div id="customAnalysisDiv">
            <calcite-label scale="s">
              Elevation | m.a.s.l
              <calcite-slider id="elevationSlider" min-value="200" max-value="2000" min="0" max="9000" ticks="500"
                step="50" snap label-handles max-label="Max Elevation" min-label="Min Elevation"></calcite-slider>
            </calcite-label>
            <calcite-label scale="s">
              Slope | ¬∞
              <calcite-slider id="slopeSlider" min-value="0" max-value="30" min="0" max="90" ticks="5" step="1" snap
                label-handles max-label="Max Slope" min-label="Min Slope"></calcite-slider>
            </calcite-label>
            <calcite-label scale="s">
              Aspect
              <div id="compassRoseDiv">
                <svg id="compassRoseSvg" xmlns="http://www.w3.org/2000/svg" viewBox="-50 -50 100 100">
                  <!-- North -->
                  <polygon points="0,-40 5,-15 -5,-15" data-aspect="n" class="roseDirection active" />
                  <text x="0" y="-45" text-anchor="middle">N</text>
  
                  <!-- North-East -->
                  <polygon points="22,-22 15,-5 5,-15" data-aspect="ne" class="roseDirection active" />
                  <text x="30" y="-30" text-anchor="middle">NE</text>
  
                  <!-- East -->
                  <polygon points="40,0 15,5 15,-5" data-aspect="e" class="roseDirection active" />
                  <text x="45" y="2" text-anchor="middle">E</text>
  
                  <!-- South-East -->
                  <polygon points="22,22 5,15 15,5" data-aspect="se" class="roseDirection active" />
                  <text x="30" y="30" text-anchor="middle">SE</text>
  
                  <!-- South -->
                  <polygon points="0,40 -5,15 5,15" data-aspect="s" class="roseDirection active" />
                  <text x="0" y="48" text-anchor="middle">S</text>
  
                  <!-- South-West -->
                  <polygon points="-22,22 -15,5 -5,15" data-aspect="sw" class="roseDirection active" />
                  <text x="-30" y="30" text-anchor="middle">SW</text>
  
                  <!-- West -->
                  <polygon points="-40,0 -15,-5 -15,5" data-aspect="w" class="roseDirection active" />
                  <text x="-45" y="2" text-anchor="middle">W</text>
  
                  <!-- North-West -->
                  <polygon points="-22,-22 -5,-15 -15,-5" data-aspect="nw" class="roseDirection active" />
                  <text x="-30" y="-30" text-anchor="middle">NW</text>
                </svg>
              </div>
            </calcite-label>
            <calcite-label scale="s">
              Color
              <calcite-popover reference-element="colorButton" closable>
                <calcite-color-picker id="colorPicker" format="rgb" closable></calcite-color-picker>
              </calcite-popover>
              <button id="colorButton"></button>
            </calcite-label>
          </div>
      `;
      
      document.body.appendChild(customUI);
      const expandWidget = new Expand(
          {
              view: view,
              content: customUI,
              expanded: false,
              expandedTooltip: "Show elevation/ Slope slider",
              collapseTooltip: "Hide elevation/ Slope slider"
          }
      )

      view.ui.add(expandWidget, "top-right");

      
      const opacitySlider = document.getElementById("opacitySlider");
      opacitySlider.addEventListener("calciteSliderInput", (event) => {
          console.log("Layer order:", map.layers.toArray());
      analysisLayer.opacity = 1 - event.target.value / 100;
      });

      const elevationSlider = document.getElementById("elevationSlider");
      elevationSlider.addEventListener("calciteSliderChange", (event) => {
      customAnalysisParams.elevation = {
          min: event.target.minValue,
          max: event.target.maxValue
      };
      analysisLayer.rasterFunction = createCustomAnalysis(customColor);
      });

      const slopeSlider = document.getElementById("slopeSlider");
      slopeSlider.addEventListener("calciteSliderChange", (event) => {
      customAnalysisParams.slope = { min: event.target.minValue, max: event.target.maxValue };
      analysisLayer.rasterFunction = createCustomAnalysis(customColor);
      });

      const roseDirections = document.getElementsByClassName("roseDirection");
      for (const roseDirection of roseDirections) {
      roseDirection.addEventListener("click", () => {
          const active = roseDirection.classList.toggle("active");
          const aspect = roseDirection.getAttribute("data-aspect").toUpperCase();
          customAnalysisParams.aspects[aspect] = active;
          analysisLayer.rasterFunction = createCustomAnalysis(customColor);
      });
      }

      const colorPicker = document.getElementById("colorPicker");
      const colorButton = document.getElementById("colorButton");
      colorPicker.addEventListener("calciteColorPickerChange", (event) => {
      const color = event.target.value;
      colorButton.style.backgroundColor = `rgb(${color.r}, ${color.g}, ${color.b})`;
      customColor = [color.r, color.g, color.b];
      analysisLayer.rasterFunction = createCustomAnalysis(customColor);
      });
      const customAnalysisDiv = document.getElementById("customAnalysisDiv");
      const aspectCompass = document.getElementById("compassRoseSvg");
      const analysisModeSegmentedControl = document.getElementById("analysisModeSegmentedControl");
      //const legendExpand = document.querySelector("arcgis-expand");
      analysisModeSegmentedControl.addEventListener("calciteSegmentedControlChange", (event) => {
          activeAnalysisMode = event.target.value;

          if (activeAnalysisMode === "Custom") {
          customAnalysisDiv.style.display = "block";
          aspectCompass.style.display = "block";
          //legendExpand.collapse();
          } else {
          customAnalysisDiv.style.display = "none";
          aspectCompass.style.display = "none";
          //legendExpand.expand();
          }

          // Reset renderer
          analysisLayer.renderer = null;

          switch (activeAnalysisMode) {
          case "Slope":
              analysisLayer.title = activeAnalysisMode + " | ¬∞";
              analysisLayer.rasterFunction = colorMapSlope;
              break;
          case "Elevation":
              analysisLayer.title = activeAnalysisMode + " | m.a.s.l";
              analysisLayer.rasterFunction = colorMapElevation;
              break;
          case "Custom":
          default:
              analysisLayer.title = activeAnalysisMode + " Analysis";
              analysisLayer.rasterFunction = createCustomAnalysis(customColor);
              break;
          }
      });
      


  });

</script>


</body>
</html>
